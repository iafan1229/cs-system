# 상담예약 시스템 PRD

> 본 문서는 기능 나열이 아닌 **설계 의사결정의 근거(Trade-off)** 와 전체 흐름 이해를 최우선으로 한다.

---

## 0. 전체 예약 프로세스 요약 (End-to-End Flow)

1. 상담사(관리자)가 상담 가능한 **시간 슬롯(스케줄)** 을 생성한다.
2. 상담사는 특정 스케줄에 대해 **이메일 상담 신청 링크**를 발송한다.
3. 신청자는 이메일 링크를 통해 접속한다.
4. 신청자는 **이미 생성된 스케줄 중 예약 가능한 슬롯**을 확인한다.
5. 신청자는 원하는 슬롯을 선택해 상담을 예약한다.
6. 상담 진행 후 상담사는 **상담 기록을 작성**한다.

> 핵심 원칙: **상담사는 시간 슬롯을 정의하고, 신청자는 슬롯을 소비(예약)한다.**

---

## 1. 제품 개요

### 1.1 목적

본 시스템은 상담사가 상담 스케줄을 관리하고, 신청자가 이메일 링크를 통해 상담을 예약할 수 있는 **상담예약 시스템**을 설계·구현하는 것을 목표로 한다.

### 1.2 설계 핵심 가치

- 동시 예약 상황에서도 **정합성 보장**
- 역할 분리를 통한 **책임 명확화**
- 실무에서 유지보수 가능한 구조

### 1.3 성공 지표 (Success Metrics)

- 동일 시간대 예약 초과 발생률: **0%**
- 예약 요청 대비 성공률: **99% 이상**
- 관리자 핵심 기능 제공률: **100%**

---

## 2. 사용자 및 역할 정의

### 2.1 상담사 (관리자)

- 상담 가능한 **시간 슬롯(스케줄)** 생성 / 수정 / 삭제
- 특정 스케줄에 대한 상담 신청 링크 이메일 발송
- 스케줄별 상담 신청 내역 조회
- 상담 완료 후 상담 기록 작성

### 2.2 신청자 (사용자)

- 이메일로 전달받은 링크를 통해 접속
- 이미 생성된 스케줄 중 **예약 가능한 시간 슬롯 조회**
- 원하는 슬롯 선택 후 상담 예약 신청
- 예약 완료 메시지 확인

---

## 3. 시스템 아키텍처 설계

### 3.1 Application 구성 (3-Tier App)

1. **Admin App (상담사 페이지)**

   - 스케줄 관리
   - 예약 내역 조회
   - 상담 기록 작성

2. **User App (상담 신청 페이지)**

   - 이메일 링크 기반 접근
   - 예약 가능한 슬롯 조회 및 예약

3. **Backend App (비즈니스 로직)**
   - REST API 제공
   - 인증 / 권한 관리
   - 동시성 제어 및 트랜잭션 처리

---

### 3.2 기술 스택

- Frontend: React
- Backend: NestJS
- Database: PostgreSQL
- ORM: TypeORM or Prisma

---

## 4. 기능 요구사항

### 4.1 상담사(관리자) 기능

#### 인증

- JWT 기반 로그인 / 로그아웃
- 관리자 권한 필수

**초기 관리자 계정 (개발/테스트용)**

- 이메일: `admin@example.com`
- 비밀번호: `admin123`
- 계정 생성 방법: `npm run seed` (backend 디렉토리에서 실행)

#### 상담 스케줄 관리

- 30분 단위 시간 슬롯 생성
- 슬롯 수정 및 삭제
- 슬롯당 최대 예약 인원: 3명

#### 상담 신청 링크

- 스케줄 단위 신청 링크 생성
- 상담사 본인 이메일로 발송

#### 상담 관리

- 스케줄별 신청자 목록 조회
- 상담 완료 후 상담 기록 작성

---

### 4.2 신청자 기능

#### 이메일 링크 접근

- 토큰 기반 단일 접근 URL
- 인증 없이 접근 가능

#### 상담 예약

- 날짜별 스케줄 조회
- 예약 가능 인원 < 최대 정원인 슬롯만 선택 가능
- 정원 초과 슬롯은 UI 및 서버에서 차단

#### 예약 완료

- 예약 데이터 DB 저장
- 완료 메시지 표시

---

## 5. 동시성 제어 및 트랜잭션 설계

### 5.1 문제 정의

- 동일 시간대에 다수의 예약 요청이 동시에 발생 가능
- 예약 정원(3명) 초과는 비즈니스적으로 허용 불가

### 5.2 선택 가능한 대안

| 방식             | 장점        | 단점           |
| ---------------- | ----------- | -------------- |
| Optimistic Lock  | 성능 우수   | 충돌 처리 복잡 |
| Pessimistic Lock | 정합성 강력 | 성능 비용      |

### 5.3 최종 선택 및 이유

- **DB 트랜잭션 + Row Lock(Pessimistic Lock)** 채택
- 이유:
  - 예약 충돌 허용 불가
  - 트래픽 규모 예측 가능
  - 구현 복잡도 대비 안정성 우선

---

## 6. 데이터베이스 설계

### 6.1 주요 엔티티

- User (Admin)
- Schedule
- Reservation
- ConsultationRecord
- AccessToken

### 6.2 관계 요약

- User(1) : Schedule(N)
- Schedule(1) : Reservation(N, 최대 3)
- Reservation(1) : ConsultationRecord(1)

---

## 7. API 설계 원칙

- RESTful 리소스 기반 설계
- Admin / Public API 역할 분리
- 정합성 검증은 서버 책임

---

## 8. 보안 설계

### 인증 및 권한

- JWT 기반 인증
- 관리자 / 신청자 권한 분리

### 보안 고려사항

- 입력값 검증
- SQL Injection 방어 (ORM)
- 이메일 링크 토큰 만료 처리

---

## 9. 개발 환경 및 배포

### 개발 환경

- Docker 기반 로컬 개발 환경
- Frontend / Backend / DB 컨테이너 분리

### 배포 시나리오

- AWS 또는 GCP
- Backend: EC2 or Container Service
- Database: Managed PostgreSQL

---

## 10. 범위 외 사항 (Out of Scope)

- 결제 기능
- 실시간 알림(SMS, Push)
- 다중 상담사 자동 매칭

---

## 11. 정리

본 PRD는

- 전체 흐름 가시화
- 설계 의사결정의 근거 명확화
- 실무 적용 가능한 구조

를 핵심 목표로 한다.

> "왜 이렇게 설계했는지"를 한 번에 이해할 수 있는 문서를 지향한다.
